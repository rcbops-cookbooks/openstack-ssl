# This file autogenerated by Chef
# Do not edit, changes will be overwritten

ServerName <%= @params[:cert_cn] %>

Listen <%= @params[:service_ip] %>:<%= @params[:service_port] %>
<VirtualHost <%= @params[:service_ip] %>:<%= @params[:service_port] %>>
  <% if @params[:service_scheme] == 'https' -%>
    ServerName            <%= @params[:cert_cn] %>
    SSLEngine             On
    SSLProtocol           +SSLv3 +TLSv1
    SSLCipherSuite        HIGH:!RC4:!MD5:!aNULL:!eNULL:!EXP:!LOW:!MEDIUM
    SSLCACertificateFile  <%= @params[:ca_cert_file] %>
    SSLCertificateFile    <%= @params[:service_cert_file] %>
    SSLCertificateKeyFile <%= @params[:service_key_file] %>

    RequestHeader         set X-Forwarded-Proto "https"
  <% end -%>

    ProxyRequests off
    ProxyPass / http://127.0.0.1:<%= @params[:service_port] %>/
    ProxyPassReverse / http://127.0.0.1:<%= @params[:service_port] %>/

    LogLevel warn
    ErrorLog <%= @params[:logdir] %>/<%= @params[:name] %>-error.log
    CustomLog <%= @params[:logdir] %>/<%= @params[:name] %>-access.log combined
</VirtualHost>

